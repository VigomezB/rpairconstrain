---
title: "Randomly pairing two vectors under inequality constraints"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Randomly pairing two vectors under inequality constraints}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  warning = FALSE,
  message = FALSE
)

library(rpairconstrain)
```

## Motivation

Randomly pair two vectors element-wise while enforcing an inequality constraint.

In many applied settings—such as tax and income microdata reconstruction from
tabulated data—researchers face the problem of **combining different components
randomly while enforcing logical or accounting constraints**.

Typical examples include:

- One income component must be **greater than or equal to** another.
- A component can be drawn from a **finite pool** (no replacement).
- Assignments should be **random**, not deterministic.

This vignette documents two helper functions provided by the
`rpairconstrain` package that address these needs.

The general idea is:

1. Start with two numeric vectors.
2. For each element of the first vector, identify feasible candidates in the
   second vector under an inequality constraint.
3. Randomly select one feasible candidate.
4. Optionally remove the selected value from the pool.

The package provides two variants (Pairing with replacement and without replacement) depending on whether reuse of values is
allowed.


## Basic usage

```{r}
set.seed(123)

x <- c(1, 2, 3, 4)
y <- c(2, 3, 5, 6)

random_sample_greater(x, y, strict = TRUE)
```

## Supported constraints

```{r}
random_sample_greater(x, y, strict = TRUE)   # >
random_sample_greater(x, y, strict = FALSE)  # >=
```

## Reproducibility

```{r}
set.seed(42)
random_sample_greater(x, y, strict = TRUE)
```

## Failure example

```{r, error = TRUE}
x <- c(5, 6, 7)
y <- c(1, 2, 3)

random_sample_greater(x, y, strict = TRUE)
```

## Without replacement

```{r}
set.seed(123)

x <- c(1, 2, 3, 4)
y <- c(2, 3, 5, 6)

out_nr <- random_sample_greater_no_replace(x, y, strict = TRUE, max_tries = 1000)
out_nr

# In this variant, if no feasible candidate is found for some x[i],
# that element may remain unchanged.
stopifnot(all(out_nr$matched_x >= out_nr$original_x | out_nr$matched_x == out_nr$original_x))
```

